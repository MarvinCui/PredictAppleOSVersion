<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta property="og:type" content="website">
    <meta property="og:title" content="Release Predictor of OS by Apple">
    <meta property="og:site_name" content="Release Predictor of OS by Apple">
    <meta property="og:description" content="Predict appleOS Release Date.">
    <meta property="og:image" content="https://borancui.site/PredictAppleOSVersion/images/EnterWebsite.png">
    <meta property="og:url" content="https://borancui.site/PredictAppleOSVersion">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Release Predictor of OS by Apple">
    <meta name="twitter:description" content="Predict appleOS Release Date.">
    <meta name="twitter:image" content="https://borancui.site/PredictAppleOSVersion/images/EnterWebsite.png">
    <meta name="twitter:url" content="https://borancui.site/PredictAppleOSVersion">
    <meta name="theme-color" content="#cae8f3">
    <meta name="author" content="Boran Cui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="appleOS Release Predictor">

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/images/site.webmanifest">

    <title>Release Predictor of OS by Apple</title>
    <link rel="icon" href="favicon.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            font-size: 2rem;
            text-align: center; /* å±…ä¸­æ ‡é¢˜ */
        }
        #predictor-container {
            background: #ffffff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* ä¿®å¤å®½åº¦é—®é¢˜ */
        }
        button {
            background: #3498db;
            color: #fff;
            border: none;
            padding: 10px 15px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        button:hover {
            background: #2980b9;
        }
        p {
            margin-top: 15px;
            font-size: 1rem;
        }
        .highlight {
            color: #27ae60;
            font-weight: bold;
        }
        footer {
            margin-top: 20px;
            text-align: center;
            padding: 10px 0;
            background: #f4f4f9;
            font-size: 0.9rem;
        }
        footer a {
            text-decoration: none;
            color: #3498db;
            font-weight: bold;
        }
        footer a:hover {
            color: #2980b9;
        }
        .os-list {
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .future-version {
            margin-top: 25px;
            font-style: italic;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
    </style>
</head>
<body>
<div id="predictor-container">
    <h1>Release Predictor of OS by Apple</h1>
    <label for="version">Enter iOS Version:</label>
    <input
            type="text"
            id="version"
            placeholder="Only major.minor format (e.g., 16.1)"
    />
    <button onclick="predict()">Predict Release Date</button>
    <p id="result"></p>
    <div id="os-list" class="os-list"></div>
    <!-- æ˜¾ç¤ºæœ€è¿‘çš„æœªæ¥ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ -->
    <div id="future-version" class="future-version"></div>
</div>
<footer>
    ğŸš€ This Website Powered by
    <a href="https://borancui.site" target="_blank">Boran Cui</a>.
</footer>

<script>
    let models;
    let minDate;

    // åŠ è½½æ¨¡å‹å’Œæ•°æ®
    fetch("models.json")
        .then((response) => response.json())
        .then((data) => {
            models = data.models;
            minDate = new Date(data.min_date);
            // åŠ è½½å®Œæˆåè‡ªåŠ¨æ˜¾ç¤ºæœ€è¿‘çš„æœªæ¥ç‰ˆæœ¬
            displayClosestFutureVersion();
        })
        .catch((error) => {
            console.error("Error loading models.json:", error);
            document.getElementById("future-version").innerText = "Error loading model data.";
        });

    /**
     * æ ¹æ® iOS ç‰ˆæœ¬å·ï¼Œè®¡ç®—å¯¹åº”å…¶ä»–ç³»ç»Ÿçš„ç‰ˆæœ¬å·
     * @param {string} iOSVersionStr - iOS ç‰ˆæœ¬å·ï¼Œæ ¼å¼ä¸º "major.minor"
     * @returns {object|null} - åŒ…å«å„ç³»ç»Ÿç‰ˆæœ¬å·çš„å¯¹è±¡ï¼Œæˆ– null å¦‚æœè¾“å…¥æ ¼å¼é”™è¯¯
     */
    function getOSVersions(iOSVersionStr) {
        const parts = iOSVersionStr.split(".");
        if (parts.length < 1) return null;

        const iOSMajor = parseInt(parts[0], 10);
        const iOSMinor = parts.length > 1 ? parseInt(parts[1], 10) : 0;
        if (isNaN(iOSMajor) || isNaN(iOSMinor)) return null;

        // iPadOS, tvOS ä¸ iOS ç›¸åŒç‰ˆæœ¬
        const iPadOS = `${iOSMajor}.${iOSMinor}`;
        const tvOS = `${iOSMajor}.${iOSMinor}`;

        // watchOS = iOSMajor - 7
        let watchOSMajor = iOSMajor - 7;
        let watchOSMinor = iOSMinor;
        const watchOS = watchOSMajor < 1
            ? "N/A"
            : `${watchOSMajor}.${watchOSMinor}`;

        // macOS = iOSMajor - 3ï¼ˆåªè¾“å‡ºæ•°å­—ç‰ˆæœ¬å·ï¼Œä¸éœ€è¦åŠ  macOS å‰ç¼€ï¼‰
        let macOSMajor = iOSMajor - 3;
        let macOSMinor = iOSMinor;
        const macOS = macOSMajor < 1
            ? "N/A"
            : `${macOSMajor}.${macOSMinor}`;

        // visionOS = iOSMajor - 16
        let visionOSMajor = iOSMajor - 16;
        let visionOSMinor = iOSMinor;
        const visionOS = visionOSMajor < 1
            ? "N/A"
            : `${visionOSMajor}.${visionOSMinor}`;

        return {
            iOS: iOSVersionStr,
            iPadOS,
            tvOS,
            watchOS,
            macOS,
            visionOS,
        };
    }

    /**
     * ä½¿ç”¨å·²åŠ è½½æ¨¡å‹ï¼Œæ ¹æ®è¾“å…¥ç‰ˆæœ¬é¢„æµ‹å‘å¸ƒæ—¥æœŸ
     * @param {number} versionNumber - iOS ç‰ˆæœ¬å·ï¼Œæµ®ç‚¹æ•°æ ¼å¼
     * @returns {Date|null} - é¢„æµ‹çš„å‘å¸ƒæ—¥æœŸï¼Œæˆ– null å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ¨¡å‹
     */
    function getPredictedDateForVersion(versionNumber) {
        if (!models) return null;

        const sortedKeys = Object.keys(models)
            .map(key => parseFloat(key))
            .sort((a, b) => a - b); // å‡åºæ’åˆ—

        let predictedDate = null;

        for (let i = 0; i < sortedKeys.length; i++) {
            const key = sortedKeys[i];
            const nextKey = sortedKeys[i + 1];
            const modelKey = key.toFixed(1);
            const model = models[modelKey];

            if (!model) continue; // è·³è¿‡æ²¡æœ‰æ¨¡å‹çš„æ•°æ®

            const startVersion = key;
            const endVersion = nextKey ? nextKey : startVersion + 1;

            if (versionNumber >= startVersion && versionNumber < endVersion) {
                const predictedDays = model.coef * versionNumber + model.intercept;
                predictedDate = new Date(
                    minDate.getTime() + predictedDays * 24 * 60 * 60 * 1000
                );
                break;
            }
        }

        return predictedDate;
    }

    /**
     * æ˜¾ç¤ºè·ç¦»ä»Šå¤©æœ€è¿‘çš„æœªæ¥ç‰ˆæœ¬
     */
    function displayClosestFutureVersion() {
        const futureVersionEl = document.getElementById("future-version");
        futureVersionEl.innerHTML = ""; // æ¸…ç©º

        if (!models) {
            futureVersionEl.innerText = "Models not loaded yet.";
            return;
        }

        const sortedKeys = Object.keys(models)
            .map(key => parseFloat(key))
            .sort((a, b) => a - b); // å‡åºæ’åˆ—

        // æ‰¾åˆ°æœ€æ–°çš„ä¸»ç‰ˆæœ¬
        const latestMajorVersion = sortedKeys[sortedKeys.length - 1];
        const latestMajorStr = latestMajorVersion.toFixed(1);

        // å®šä¹‰å­ç‰ˆæœ¬çš„èŒƒå›´ï¼Œä¾‹å¦‚0.1åˆ°10.0
        const maxMinor = 10;
        let closestVersionKey = null;
        let closestDate = null;
        const today = new Date();

        for (let minor = 1; minor <= maxMinor; minor++) {
            const versionNumber = parseFloat((latestMajorVersion + minor * 0.1).toFixed(1));
            const predictedDate = getPredictedDateForVersion(versionNumber);

            // è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
            // console.log(`Version ${versionNumber}: Predicted Date = ${predictedDate}`);

            if (predictedDate && predictedDate > today) {
                closestVersionKey = versionNumber.toFixed(1);
                closestDate = predictedDate;
                break; // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ç‰ˆæœ¬å³å¯
            }
        }

        if (closestVersionKey && closestDate) {
            const futureOSMap = getOSVersions(closestVersionKey);
            if (futureOSMap) {
                futureVersionEl.innerHTML = `
            <div>
              Predicted release date of the nearest future version: <span class="highlight">${closestDate.toISOString().split("T")[0]}</span><br/>
              <br/>
              <strong>List of systems with upcoming releases:</strong><br/>
              <a href="https://www.apple.com/ios/" target="_blank" rel="noopener noreferrer">iOS</a>: <span class="highlight">${futureOSMap.iOS}</span><br/>
              <a href="https://www.apple.com/ipados/" target="_blank" rel="noopener noreferrer">iPadOS</a>: <span class="highlight">${futureOSMap.iPadOS}</span><br/>
              <a href="https://www.apple.com/tv-home/" target="_blank" rel="noopener noreferrer">tvOS</a>: <span class="highlight">${futureOSMap.tvOS}</span><br/>
              <a href="https://www.apple.com/watchos/" target="_blank" rel="noopener noreferrer">watchOS</a>: <span class="highlight">${futureOSMap.watchOS}</span><br/>
              <a href="https://www.apple.com/macos/" target="_blank" rel="noopener noreferrer">macOS</a>: <span class="highlight">${futureOSMap.macOS}</span><br/>
              <a href="https://www.apple.com/visionos/" target="_blank" rel="noopener noreferrer">visionOS</a>: <span class="highlight">${futureOSMap.visionOS}</span>
            </div>
          `;
            }
        } else {
            // å¦‚æœåœ¨ä¸»ç‰ˆæœ¬çš„å­ç‰ˆæœ¬ä¸­æ²¡æœ‰æ‰¾åˆ°æœªæ¥ç‰ˆæœ¬ï¼Œå¯ä»¥è€ƒè™‘æŸ¥æ‰¾ä¸‹ä¸€ä¸ªä¸»ç‰ˆæœ¬
            futureVersionEl.innerText = "No future version found.";
        }
    }

    /**
     * ç‚¹å‡»æŒ‰é’®åï¼Œé¢„æµ‹ç”¨æˆ·è¾“å…¥çš„ç‰ˆæœ¬å‘å¸ƒæ—¶é—´ï¼Œå¹¶è¾“å‡ºå¯¹åº”OSç‰ˆæœ¬
     */
    function predict() {
        const versionInput = document.getElementById("version").value.trim();
        const versionNumber = parseFloat(versionInput);
        const resultEl = document.getElementById("result");
        const osListEl = document.getElementById("os-list");

        // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
        resultEl.innerHTML = "";
        osListEl.innerHTML = "";

        if (!models || isNaN(versionNumber)) {
            resultEl.innerText = "Invalid input or model not loaded.";
            return;
        }

        // é¢„æµ‹ç”¨æˆ·è¾“å…¥ç‰ˆæœ¬çš„å‘å¸ƒæ—¥æœŸ
        const predictedDate = getPredictedDateForVersion(versionNumber);
        if (!predictedDate) {
            resultEl.innerText = "No suitable model found for the input version.";
            return;
        }

        // æ˜¾ç¤º iOS å‘å¸ƒé¢„æµ‹
        resultEl.innerHTML = `
        Predicted release date for <span class="highlight">iOS ${versionInput}</span>:
        <span class="highlight">${predictedDate.toISOString().split("T")[0]}</span>
      `;

        // æ˜¾ç¤ºå…¶ä»–ç³»ç»Ÿå¯¹åº”ç‰ˆæœ¬
        const osMap = getOSVersions(versionInput);
        if (osMap) {
            const { iPadOS, tvOS, watchOS, macOS, visionOS } = osMap;
            osListEl.innerHTML = `
          <strong>Equivalent Versions:</strong><br/>
          iPadOS: <span class="highlight">${iPadOS}</span><br/>
          tvOS: <span class="highlight">${tvOS}</span><br/>
          watchOS: <span class="highlight">${watchOS}</span><br/>
          macOS: <span class="highlight">${macOS}</span><br/>
          visionOS: <span class="highlight">${visionOS}</span>
        `;
        }
    }
</script>
</body>
</html>